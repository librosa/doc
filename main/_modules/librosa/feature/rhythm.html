<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>librosa.feature.rhythm &mdash; librosa 0.10.1 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery-rendered-html.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >

          
          
          <a href="../../../index.html">
            
              <img src="../../../_static/librosa_logo_text.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.10
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../core.html">Core IO and DSP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../display.html">Display</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../feature.html">Feature extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../onset.html">Onset detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../beat.html">Beat and tempo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../decompose.html">Spectrogram decomposition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../effects.html">Effects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../segment.html">Temporal segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sequence.html">Sequential modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../util.html">Utilities</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../multichannel.html">Multi-channel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../filters.html">Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cache.html">Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ioformats.html">Advanced I/O Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../advanced.html">Advanced examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../recordings.html">Example files</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../genindex.html">Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: white" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">librosa</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">librosa.feature.rhythm</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             

<div class="admonition danger">
    <p class="admonition-title"> Caution </p>
  <p>
    
        You're reading the documentation for a development version.
        For the latest released version, please have a look at <a href="../../../../0.10.0/index.html">0.10.0</a>.
    
  </p>
</div>


  <h1>Source code for librosa.feature.rhythm</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;Rhythmic feature extraction&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span>

<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">util</span>

<span class="kn">from</span> <span class="nn">.._cache</span> <span class="kn">import</span> <span class="n">cache</span>
<span class="kn">from</span> <span class="nn">..core.audio</span> <span class="kn">import</span> <span class="n">autocorrelate</span>
<span class="kn">from</span> <span class="nn">..core.spectrum</span> <span class="kn">import</span> <span class="n">stft</span>
<span class="kn">from</span> <span class="nn">..core.convert</span> <span class="kn">import</span> <span class="n">tempo_frequencies</span><span class="p">,</span> <span class="n">time_to_frames</span>
<span class="kn">from</span> <span class="nn">..core.harmonic</span> <span class="kn">import</span> <span class="n">f0_harmonics</span>
<span class="kn">from</span> <span class="nn">..util.exceptions</span> <span class="kn">import</span> <span class="n">ParameterError</span>
<span class="kn">from</span> <span class="nn">..filters</span> <span class="kn">import</span> <span class="n">get_window</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Any</span>
<span class="kn">from</span> <span class="nn">.._typing</span> <span class="kn">import</span> <span class="n">_WindowSpec</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;tempogram&quot;</span><span class="p">,</span> <span class="s2">&quot;fourier_tempogram&quot;</span><span class="p">,</span> <span class="s2">&quot;tempo&quot;</span><span class="p">,</span> <span class="s2">&quot;tempogram_ratio&quot;</span><span class="p">]</span>


<span class="c1"># -- Rhythmic features -- #</span>
<div class="viewcode-block" id="tempogram"><a class="viewcode-back" href="../../../generated/librosa.feature.tempogram.html#librosa.feature.tempogram">[docs]</a><span class="k">def</span> <span class="nf">tempogram</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">y</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">sr</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">22050</span><span class="p">,</span>
    <span class="n">onset_envelope</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">hop_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">512</span><span class="p">,</span>
    <span class="n">win_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">384</span><span class="p">,</span>
    <span class="n">center</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">window</span><span class="p">:</span> <span class="n">_WindowSpec</span> <span class="o">=</span> <span class="s2">&quot;hann&quot;</span><span class="p">,</span>
    <span class="n">norm</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the tempogram: local autocorrelation of the onset strength envelope. [#]_</span>

<span class="sd">    .. [#] Grosche, Peter, Meinard Müller, and Frank Kurth.</span>
<span class="sd">        &quot;Cyclic tempogram - A mid-level tempo representation for music signals.&quot;</span>
<span class="sd">        ICASSP, 2010.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    y : np.ndarray [shape=(..., n)] or None</span>
<span class="sd">        Audio time series.  Multi-channel is supported.</span>

<span class="sd">    sr : number &gt; 0 [scalar]</span>
<span class="sd">        sampling rate of ``y``</span>

<span class="sd">    onset_envelope : np.ndarray [shape=(..., n) or (..., m, n)] or None</span>
<span class="sd">        Optional pre-computed onset strength envelope as provided by</span>
<span class="sd">        `librosa.onset.onset_strength`.</span>

<span class="sd">        If multi-dimensional, tempograms are computed independently for each</span>
<span class="sd">        band (first dimension).</span>

<span class="sd">    hop_length : int &gt; 0</span>
<span class="sd">        number of audio samples between successive onset measurements</span>

<span class="sd">    win_length : int &gt; 0</span>
<span class="sd">        length of the onset autocorrelation window (in frames/onset measurements)</span>
<span class="sd">        The default settings (384) corresponds to ``384 * hop_length / sr ~= 8.9s``.</span>

<span class="sd">    center : bool</span>
<span class="sd">        If `True`, onset autocorrelation windows are centered.</span>
<span class="sd">        If `False`, windows are left-aligned.</span>

<span class="sd">    window : string, function, number, tuple, or np.ndarray [shape=(win_length,)]</span>
<span class="sd">        A window specification as in `stft`.</span>

<span class="sd">    norm : {np.inf, -np.inf, 0, float &gt; 0, None}</span>
<span class="sd">        Normalization mode.  Set to `None` to disable normalization.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tempogram : np.ndarray [shape=(..., win_length, n)]</span>
<span class="sd">        Localized autocorrelation of the onset strength envelope.</span>

<span class="sd">        If given multi-band input (``onset_envelope.shape==(m,n)``) then</span>
<span class="sd">        ``tempogram[i]`` is the tempogram of ``onset_envelope[i]``.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ParameterError</span>
<span class="sd">        if neither ``y`` nor ``onset_envelope`` are provided</span>

<span class="sd">        if ``win_length &lt; 1``</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    fourier_tempogram</span>
<span class="sd">    librosa.onset.onset_strength</span>
<span class="sd">    librosa.util.normalize</span>
<span class="sd">    librosa.stft</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; # Compute local onset autocorrelation</span>
<span class="sd">    &gt;&gt;&gt; y, sr = librosa.load(librosa.ex(&#39;nutcracker&#39;), duration=30)</span>
<span class="sd">    &gt;&gt;&gt; hop_length = 512</span>
<span class="sd">    &gt;&gt;&gt; oenv = librosa.onset.onset_strength(y=y, sr=sr, hop_length=hop_length)</span>
<span class="sd">    &gt;&gt;&gt; tempogram = librosa.feature.tempogram(onset_envelope=oenv, sr=sr,</span>
<span class="sd">    ...                                       hop_length=hop_length)</span>
<span class="sd">    &gt;&gt;&gt; # Compute global onset autocorrelation</span>
<span class="sd">    &gt;&gt;&gt; ac_global = librosa.autocorrelate(oenv, max_size=tempogram.shape[0])</span>
<span class="sd">    &gt;&gt;&gt; ac_global = librosa.util.normalize(ac_global)</span>
<span class="sd">    &gt;&gt;&gt; # Estimate the global tempo for display purposes</span>
<span class="sd">    &gt;&gt;&gt; tempo = librosa.feature.tempo(onset_envelope=oenv, sr=sr,</span>
<span class="sd">    ...                               hop_length=hop_length)[0]</span>

<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots(nrows=4, figsize=(10, 10))</span>
<span class="sd">    &gt;&gt;&gt; times = librosa.times_like(oenv, sr=sr, hop_length=hop_length)</span>
<span class="sd">    &gt;&gt;&gt; ax[0].plot(times, oenv, label=&#39;Onset strength&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax[0].label_outer()</span>
<span class="sd">    &gt;&gt;&gt; ax[0].legend(frameon=True)</span>
<span class="sd">    &gt;&gt;&gt; librosa.display.specshow(tempogram, sr=sr, hop_length=hop_length,</span>
<span class="sd">    &gt;&gt;&gt;                          x_axis=&#39;time&#39;, y_axis=&#39;tempo&#39;, cmap=&#39;magma&#39;,</span>
<span class="sd">    ...                          ax=ax[1])</span>
<span class="sd">    &gt;&gt;&gt; ax[1].axhline(tempo, color=&#39;w&#39;, linestyle=&#39;--&#39;, alpha=1,</span>
<span class="sd">    ...             label=&#39;Estimated tempo={:g}&#39;.format(tempo))</span>
<span class="sd">    &gt;&gt;&gt; ax[1].legend(loc=&#39;upper right&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax[1].set(title=&#39;Tempogram&#39;)</span>
<span class="sd">    &gt;&gt;&gt; x = np.linspace(0, tempogram.shape[0] * float(hop_length) / sr,</span>
<span class="sd">    ...                 num=tempogram.shape[0])</span>
<span class="sd">    &gt;&gt;&gt; ax[2].plot(x, np.mean(tempogram, axis=1), label=&#39;Mean local autocorrelation&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax[2].plot(x, ac_global, &#39;--&#39;, alpha=0.75, label=&#39;Global autocorrelation&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax[2].set(xlabel=&#39;Lag (seconds)&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax[2].legend(frameon=True)</span>
<span class="sd">    &gt;&gt;&gt; freqs = librosa.tempo_frequencies(tempogram.shape[0], hop_length=hop_length, sr=sr)</span>
<span class="sd">    &gt;&gt;&gt; ax[3].semilogx(freqs[1:], np.mean(tempogram[1:], axis=1),</span>
<span class="sd">    ...              label=&#39;Mean local autocorrelation&#39;, base=2)</span>
<span class="sd">    &gt;&gt;&gt; ax[3].semilogx(freqs[1:], ac_global[1:], &#39;--&#39;, alpha=0.75,</span>
<span class="sd">    ...              label=&#39;Global autocorrelation&#39;, base=2)</span>
<span class="sd">    &gt;&gt;&gt; ax[3].axvline(tempo, color=&#39;black&#39;, linestyle=&#39;--&#39;, alpha=.8,</span>
<span class="sd">    ...             label=&#39;Estimated tempo={:g}&#39;.format(tempo))</span>
<span class="sd">    &gt;&gt;&gt; ax[3].legend(frameon=True)</span>
<span class="sd">    &gt;&gt;&gt; ax[3].set(xlabel=&#39;BPM&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax[3].grid(True)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">..onset</span> <span class="kn">import</span> <span class="n">onset_strength</span>

    <span class="k">if</span> <span class="n">win_length</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="s2">&quot;win_length must be a positive integer&quot;</span><span class="p">)</span>

    <span class="n">ac_window</span> <span class="o">=</span> <span class="n">get_window</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">win_length</span><span class="p">,</span> <span class="n">fftbins</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">onset_envelope</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="s2">&quot;Either y or onset_envelope must be provided&quot;</span><span class="p">)</span>

        <span class="n">onset_envelope</span> <span class="o">=</span> <span class="n">onset_strength</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">,</span> <span class="n">hop_length</span><span class="o">=</span><span class="n">hop_length</span><span class="p">)</span>

    <span class="c1"># Center the autocorrelation windows</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">onset_envelope</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">center</span><span class="p">:</span>
        <span class="n">padding</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">onset_envelope</span><span class="o">.</span><span class="n">shape</span><span class="p">]</span>
        <span class="n">padding</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">win_length</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),)</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="n">onset_envelope</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
            <span class="n">onset_envelope</span><span class="p">,</span> <span class="n">padding</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;linear_ramp&quot;</span><span class="p">,</span> <span class="n">end_values</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="c1"># Carve onset envelope into frames</span>
    <span class="n">odf_frame</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">frame</span><span class="p">(</span><span class="n">onset_envelope</span><span class="p">,</span> <span class="n">frame_length</span><span class="o">=</span><span class="n">win_length</span><span class="p">,</span> <span class="n">hop_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Truncate to the length of the original signal</span>
    <span class="k">if</span> <span class="n">center</span><span class="p">:</span>
        <span class="n">odf_frame</span> <span class="o">=</span> <span class="n">odf_frame</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="n">n</span><span class="p">]</span>

    <span class="c1"># explicit broadcast of ac_window</span>
    <span class="n">ac_window</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">expand_to</span><span class="p">(</span><span class="n">ac_window</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="n">odf_frame</span><span class="o">.</span><span class="n">ndim</span><span class="p">,</span> <span class="n">axes</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Window, autocorrelate, and normalize</span>
    <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span>
        <span class="n">autocorrelate</span><span class="p">(</span><span class="n">odf_frame</span> <span class="o">*</span> <span class="n">ac_window</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">),</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">2</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="fourier_tempogram"><a class="viewcode-back" href="../../../generated/librosa.feature.fourier_tempogram.html#librosa.feature.fourier_tempogram">[docs]</a><span class="k">def</span> <span class="nf">fourier_tempogram</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">y</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">sr</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">22050</span><span class="p">,</span>
    <span class="n">onset_envelope</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">hop_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">512</span><span class="p">,</span>
    <span class="n">win_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">384</span><span class="p">,</span>
    <span class="n">center</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">window</span><span class="p">:</span> <span class="n">_WindowSpec</span> <span class="o">=</span> <span class="s2">&quot;hann&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the Fourier tempogram: the short-time Fourier transform of the</span>
<span class="sd">    onset strength envelope. [#]_</span>

<span class="sd">    .. [#] Grosche, Peter, Meinard Müller, and Frank Kurth.</span>
<span class="sd">        &quot;Cyclic tempogram - A mid-level tempo representation for music signals.&quot;</span>
<span class="sd">        ICASSP, 2010.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    y : np.ndarray [shape=(..., n)] or None</span>
<span class="sd">        Audio time series.  Multi-channel is supported.</span>
<span class="sd">    sr : number &gt; 0 [scalar]</span>
<span class="sd">        sampling rate of ``y``</span>
<span class="sd">    onset_envelope : np.ndarray [shape=(..., n)] or None</span>
<span class="sd">        Optional pre-computed onset strength envelope as provided by</span>
<span class="sd">        ``librosa.onset.onset_strength``.</span>
<span class="sd">        Multi-channel is supported.</span>
<span class="sd">    hop_length : int &gt; 0</span>
<span class="sd">        number of audio samples between successive onset measurements</span>
<span class="sd">    win_length : int &gt; 0</span>
<span class="sd">        length of the onset window (in frames/onset measurements)</span>
<span class="sd">        The default settings (384) corresponds to ``384 * hop_length / sr ~= 8.9s``.</span>
<span class="sd">    center : bool</span>
<span class="sd">        If `True`, onset windows are centered.</span>
<span class="sd">        If `False`, windows are left-aligned.</span>
<span class="sd">    window : string, function, number, tuple, or np.ndarray [shape=(win_length,)]</span>
<span class="sd">        A window specification as in `stft`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tempogram : np.ndarray [shape=(..., win_length // 2 + 1, n)]</span>
<span class="sd">        Complex short-time Fourier transform of the onset envelope.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ParameterError</span>
<span class="sd">        if neither ``y`` nor ``onset_envelope`` are provided</span>

<span class="sd">        if ``win_length &lt; 1``</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    tempogram</span>
<span class="sd">    librosa.onset.onset_strength</span>
<span class="sd">    librosa.util.normalize</span>
<span class="sd">    librosa.stft</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; # Compute local onset autocorrelation</span>
<span class="sd">    &gt;&gt;&gt; y, sr = librosa.load(librosa.ex(&#39;nutcracker&#39;))</span>
<span class="sd">    &gt;&gt;&gt; hop_length = 512</span>
<span class="sd">    &gt;&gt;&gt; oenv = librosa.onset.onset_strength(y=y, sr=sr, hop_length=hop_length)</span>
<span class="sd">    &gt;&gt;&gt; tempogram = librosa.feature.fourier_tempogram(onset_envelope=oenv, sr=sr,</span>
<span class="sd">    ...                                               hop_length=hop_length)</span>
<span class="sd">    &gt;&gt;&gt; # Compute the auto-correlation tempogram, unnormalized to make comparison easier</span>
<span class="sd">    &gt;&gt;&gt; ac_tempogram = librosa.feature.tempogram(onset_envelope=oenv, sr=sr,</span>
<span class="sd">    ...                                          hop_length=hop_length, norm=None)</span>

<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots(nrows=3, sharex=True)</span>
<span class="sd">    &gt;&gt;&gt; ax[0].plot(librosa.times_like(oenv), oenv, label=&#39;Onset strength&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax[0].legend(frameon=True)</span>
<span class="sd">    &gt;&gt;&gt; ax[0].label_outer()</span>
<span class="sd">    &gt;&gt;&gt; librosa.display.specshow(np.abs(tempogram), sr=sr, hop_length=hop_length,</span>
<span class="sd">    &gt;&gt;&gt;                          x_axis=&#39;time&#39;, y_axis=&#39;fourier_tempo&#39;, cmap=&#39;magma&#39;,</span>
<span class="sd">    ...                          ax=ax[1])</span>
<span class="sd">    &gt;&gt;&gt; ax[1].set(title=&#39;Fourier tempogram&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax[1].label_outer()</span>
<span class="sd">    &gt;&gt;&gt; librosa.display.specshow(ac_tempogram, sr=sr, hop_length=hop_length,</span>
<span class="sd">    &gt;&gt;&gt;                          x_axis=&#39;time&#39;, y_axis=&#39;tempo&#39;, cmap=&#39;magma&#39;,</span>
<span class="sd">    ...                          ax=ax[2])</span>
<span class="sd">    &gt;&gt;&gt; ax[2].set(title=&#39;Autocorrelation tempogram&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">..onset</span> <span class="kn">import</span> <span class="n">onset_strength</span>

    <span class="k">if</span> <span class="n">win_length</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="s2">&quot;win_length must be a positive integer&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">onset_envelope</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="s2">&quot;Either y or onset_envelope must be provided&quot;</span><span class="p">)</span>

        <span class="n">onset_envelope</span> <span class="o">=</span> <span class="n">onset_strength</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">,</span> <span class="n">hop_length</span><span class="o">=</span><span class="n">hop_length</span><span class="p">)</span>

    <span class="c1"># Generate the short-time Fourier transform</span>
    <span class="k">return</span> <span class="n">stft</span><span class="p">(</span>
        <span class="n">onset_envelope</span><span class="p">,</span> <span class="n">n_fft</span><span class="o">=</span><span class="n">win_length</span><span class="p">,</span> <span class="n">hop_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">window</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="tempo"><a class="viewcode-back" href="../../../generated/librosa.feature.tempo.html#librosa.feature.tempo">[docs]</a><span class="nd">@cache</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">tempo</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">y</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">sr</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">22050</span><span class="p">,</span>
    <span class="n">onset_envelope</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">tg</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">hop_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">512</span><span class="p">,</span>
    <span class="n">start_bpm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">120</span><span class="p">,</span>
    <span class="n">std_bpm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">ac_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">8.0</span><span class="p">,</span>
    <span class="n">max_tempo</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">320.0</span><span class="p">,</span>
    <span class="n">aggregate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>
    <span class="n">prior</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">rv_continuous</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Estimate the tempo (beats per minute)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    y : np.ndarray [shape=(..., n)] or None</span>
<span class="sd">        audio time series. Multi-channel is supported.</span>
<span class="sd">    sr : number &gt; 0 [scalar]</span>
<span class="sd">        sampling rate of the time series</span>
<span class="sd">    onset_envelope : np.ndarray [shape=(..., n)]</span>
<span class="sd">        pre-computed onset strength envelope</span>
<span class="sd">    tg : np.ndarray</span>
<span class="sd">        pre-computed tempogram.  If provided, then `y` and</span>
<span class="sd">        `onset_envelope` are ignored, and `win_length` is</span>
<span class="sd">        inferred from the shape of the tempogram.</span>
<span class="sd">    hop_length : int &gt; 0 [scalar]</span>
<span class="sd">        hop length of the time series</span>
<span class="sd">    start_bpm : float [scalar]</span>
<span class="sd">        initial guess of the BPM</span>
<span class="sd">    std_bpm : float &gt; 0 [scalar]</span>
<span class="sd">        standard deviation of tempo distribution</span>
<span class="sd">    ac_size : float &gt; 0 [scalar]</span>
<span class="sd">        length (in seconds) of the auto-correlation window</span>
<span class="sd">    max_tempo : float &gt; 0 [scalar, optional]</span>
<span class="sd">        If provided, only estimate tempo below this threshold</span>
<span class="sd">    aggregate : callable [optional]</span>
<span class="sd">        Aggregation function for estimating global tempo.</span>
<span class="sd">        If `None`, then tempo is estimated independently for each frame.</span>
<span class="sd">    prior : scipy.stats.rv_continuous [optional]</span>
<span class="sd">        A prior distribution over tempo (in beats per minute).</span>
<span class="sd">        By default, a pseudo-log-normal prior is used.</span>
<span class="sd">        If given, ``start_bpm`` and ``std_bpm`` will be ignored.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tempo : np.ndarray</span>
<span class="sd">        estimated tempo (beats per minute).</span>
<span class="sd">        If input is multi-channel, one tempo estimate per channel is provided.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    librosa.onset.onset_strength</span>
<span class="sd">    librosa.feature.tempogram</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function caches at level 30.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; # Estimate a static tempo</span>
<span class="sd">    &gt;&gt;&gt; y, sr = librosa.load(librosa.ex(&#39;nutcracker&#39;), duration=30)</span>
<span class="sd">    &gt;&gt;&gt; onset_env = librosa.onset.onset_strength(y=y, sr=sr)</span>
<span class="sd">    &gt;&gt;&gt; tempo = librosa.feature.tempo(onset_envelope=onset_env, sr=sr)</span>
<span class="sd">    &gt;&gt;&gt; tempo</span>
<span class="sd">    array([143.555])</span>

<span class="sd">    &gt;&gt;&gt; # Or a static tempo with a uniform prior instead</span>
<span class="sd">    &gt;&gt;&gt; import scipy.stats</span>
<span class="sd">    &gt;&gt;&gt; prior = scipy.stats.uniform(30, 300)  # uniform over 30-300 BPM</span>
<span class="sd">    &gt;&gt;&gt; utempo = librosa.feature.tempo(onset_envelope=onset_env, sr=sr, prior=prior)</span>
<span class="sd">    &gt;&gt;&gt; utempo</span>
<span class="sd">    array([161.499])</span>

<span class="sd">    &gt;&gt;&gt; # Or a dynamic tempo</span>
<span class="sd">    &gt;&gt;&gt; dtempo = librosa.feature.tempo(onset_envelope=onset_env, sr=sr,</span>
<span class="sd">    ...                                aggregate=None)</span>
<span class="sd">    &gt;&gt;&gt; dtempo</span>
<span class="sd">    array([ 89.103,  89.103,  89.103, ..., 123.047, 123.047, 123.047])</span>

<span class="sd">    &gt;&gt;&gt; # Dynamic tempo with a proper log-normal prior</span>
<span class="sd">    &gt;&gt;&gt; prior_lognorm = scipy.stats.lognorm(loc=np.log(120), scale=120, s=1)</span>
<span class="sd">    &gt;&gt;&gt; dtempo_lognorm = librosa.feature.tempo(onset_envelope=onset_env, sr=sr,</span>
<span class="sd">    ...                                        aggregate=None,</span>
<span class="sd">    ...                                        prior=prior_lognorm)</span>
<span class="sd">    &gt;&gt;&gt; dtempo_lognorm</span>
<span class="sd">    array([ 89.103,  89.103,  89.103, ..., 123.047, 123.047, 123.047])</span>

<span class="sd">    Plot the estimated tempo against the onset autocorrelation</span>

<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; # Convert to scalar</span>
<span class="sd">    &gt;&gt;&gt; tempo = tempo.item()</span>
<span class="sd">    &gt;&gt;&gt; utempo = utempo.item()</span>
<span class="sd">    &gt;&gt;&gt; # Compute 2-second windowed autocorrelation</span>
<span class="sd">    &gt;&gt;&gt; hop_length = 512</span>
<span class="sd">    &gt;&gt;&gt; ac = librosa.autocorrelate(onset_env, max_size=2 * sr // hop_length)</span>
<span class="sd">    &gt;&gt;&gt; freqs = librosa.tempo_frequencies(len(ac), sr=sr,</span>
<span class="sd">    ...                                   hop_length=hop_length)</span>
<span class="sd">    &gt;&gt;&gt; # Plot on a BPM axis.  We skip the first (0-lag) bin.</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots()</span>
<span class="sd">    &gt;&gt;&gt; ax.semilogx(freqs[1:], librosa.util.normalize(ac)[1:],</span>
<span class="sd">    ...              label=&#39;Onset autocorrelation&#39;, base=2)</span>
<span class="sd">    &gt;&gt;&gt; ax.axvline(tempo, 0, 1, alpha=0.75, linestyle=&#39;--&#39;, color=&#39;r&#39;,</span>
<span class="sd">    ...             label=&#39;Tempo (default prior): {:.2f} BPM&#39;.format(tempo))</span>
<span class="sd">    &gt;&gt;&gt; ax.axvline(utempo, 0, 1, alpha=0.75, linestyle=&#39;:&#39;, color=&#39;g&#39;,</span>
<span class="sd">    ...             label=&#39;Tempo (uniform prior): {:.2f} BPM&#39;.format(utempo))</span>
<span class="sd">    &gt;&gt;&gt; ax.set(xlabel=&#39;Tempo (BPM)&#39;, title=&#39;Static tempo estimation&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax.grid(True)</span>
<span class="sd">    &gt;&gt;&gt; ax.legend()</span>

<span class="sd">    Plot dynamic tempo estimates over a tempogram</span>

<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots()</span>
<span class="sd">    &gt;&gt;&gt; tg = librosa.feature.tempogram(onset_envelope=onset_env, sr=sr,</span>
<span class="sd">    ...                                hop_length=hop_length)</span>
<span class="sd">    &gt;&gt;&gt; librosa.display.specshow(tg, x_axis=&#39;time&#39;, y_axis=&#39;tempo&#39;, cmap=&#39;magma&#39;, ax=ax)</span>
<span class="sd">    &gt;&gt;&gt; ax.plot(librosa.times_like(dtempo), dtempo,</span>
<span class="sd">    ...          color=&#39;c&#39;, linewidth=1.5, label=&#39;Tempo estimate (default prior)&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax.plot(librosa.times_like(dtempo_lognorm), dtempo_lognorm,</span>
<span class="sd">    ...          color=&#39;c&#39;, linewidth=1.5, linestyle=&#39;--&#39;,</span>
<span class="sd">    ...          label=&#39;Tempo estimate (lognorm prior)&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax.set(title=&#39;Dynamic tempo estimation&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax.legend()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">start_bpm</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ParameterError</span><span class="p">(</span><span class="s2">&quot;start_bpm must be strictly positive&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">tg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">win_length</span> <span class="o">=</span> <span class="n">time_to_frames</span><span class="p">(</span><span class="n">ac_size</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">,</span> <span class="n">hop_length</span><span class="o">=</span><span class="n">hop_length</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

        <span class="n">tg</span> <span class="o">=</span> <span class="n">tempogram</span><span class="p">(</span>
            <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
            <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">,</span>
            <span class="n">onset_envelope</span><span class="o">=</span><span class="n">onset_envelope</span><span class="p">,</span>
            <span class="n">hop_length</span><span class="o">=</span><span class="n">hop_length</span><span class="p">,</span>
            <span class="n">win_length</span><span class="o">=</span><span class="n">win_length</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Override window length by what&#39;s actually given</span>
        <span class="n">win_length</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

    <span class="c1"># Eventually, we want this to work for time-varying tempo</span>
    <span class="k">if</span> <span class="n">aggregate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tg</span> <span class="o">=</span> <span class="n">aggregate</span><span class="p">(</span><span class="n">tg</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">tg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="c1"># Get the BPM values for each bin, skipping the 0-lag bin</span>
    <span class="n">bpms</span> <span class="o">=</span> <span class="n">tempo_frequencies</span><span class="p">(</span><span class="n">win_length</span><span class="p">,</span> <span class="n">hop_length</span><span class="o">=</span><span class="n">hop_length</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">)</span>

    <span class="c1"># Weight the autocorrelation by a log-normal distribution</span>
    <span class="k">if</span> <span class="n">prior</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logprior</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">bpms</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">start_bpm</span><span class="p">))</span> <span class="o">/</span> <span class="n">std_bpm</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logprior</span> <span class="o">=</span> <span class="n">prior</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">bpms</span><span class="p">)</span>

    <span class="c1"># Kill everything above the max tempo</span>
    <span class="k">if</span> <span class="n">max_tempo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">max_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">bpms</span> <span class="o">&lt;</span> <span class="n">max_tempo</span><span class="p">))</span>
        <span class="n">logprior</span><span class="p">[:</span><span class="n">max_idx</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="c1"># explicit axis expansion</span>
    <span class="n">logprior</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">expand_to</span><span class="p">(</span><span class="n">logprior</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="n">tg</span><span class="o">.</span><span class="n">ndim</span><span class="p">,</span> <span class="n">axes</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Get the maximum, weighted by the prior</span>
    <span class="c1"># Using log1p here for numerical stability</span>
    <span class="n">best_period</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="mf">1e6</span> <span class="o">*</span> <span class="n">tg</span><span class="p">)</span> <span class="o">+</span> <span class="n">logprior</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">tempo_est</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">bpms</span><span class="p">,</span> <span class="n">best_period</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tempo_est</span></div>


<div class="viewcode-block" id="tempogram_ratio"><a class="viewcode-back" href="../../../generated/librosa.feature.tempogram_ratio.html#librosa.feature.tempogram_ratio">[docs]</a><span class="nd">@cache</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">tempogram_ratio</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">y</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">sr</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">22050</span><span class="p">,</span>
    <span class="n">onset_envelope</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">tg</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">bpm</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">hop_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">512</span><span class="p">,</span>
    <span class="n">win_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">384</span><span class="p">,</span>
    <span class="n">start_bpm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">120</span><span class="p">,</span>
    <span class="n">std_bpm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">max_tempo</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">320.0</span><span class="p">,</span>
    <span class="n">freqs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">factors</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">aggregate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">prior</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">rv_continuous</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">center</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">window</span><span class="p">:</span> <span class="n">_WindowSpec</span> <span class="o">=</span> <span class="s2">&quot;hann&quot;</span><span class="p">,</span>
    <span class="n">kind</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span><span class="p">,</span>
    <span class="n">fill_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">norm</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tempogram ratio features, also known as spectral rhythm patterns. [1]_</span>

<span class="sd">    This function summarizes the energy at metrically important multiples</span>
<span class="sd">    of the tempo.  For example, if the tempo corresponds to the quarter-note</span>
<span class="sd">    period, the tempogram ratio will measure the energy at the eighth note,</span>
<span class="sd">    sixteenth note, half note, whole note, etc. periods, as well as dotted</span>
<span class="sd">    and triplet ratios.</span>

<span class="sd">    By default, the multiplicative factors used here are as specified by</span>
<span class="sd">    [2]_.  If the estimated tempo corresponds to a quarter note, these factors</span>
<span class="sd">    will measure relative energy at the following metrical subdivisions:</span>

<span class="sd">    +-------+--------+------------------+</span>
<span class="sd">    | Index | Factor | Description      |</span>
<span class="sd">    +=======+========+==================+</span>
<span class="sd">    |     0 |    4   | Sixteenth note   |</span>
<span class="sd">    +-------+--------+------------------+</span>
<span class="sd">    |     1 |    8/3 | Dotted sixteenth |</span>
<span class="sd">    +-------+--------+------------------+</span>
<span class="sd">    |     2 |    3   | Eighth triplet   |</span>
<span class="sd">    +-------+--------+------------------+</span>
<span class="sd">    |     3 |    2   | Eighth note      |</span>
<span class="sd">    +-------+--------+------------------+</span>
<span class="sd">    |     4 |    4/3 | Dotted eighth    |</span>
<span class="sd">    +-------+--------+------------------+</span>
<span class="sd">    |     5 |    3/2 | Quarter triplet  |</span>
<span class="sd">    +-------+--------+------------------+</span>
<span class="sd">    |     6 |    1   | Quarter note     |</span>
<span class="sd">    +-------+--------+------------------+</span>
<span class="sd">    |     7 |    2/3 | Dotted quarter   |</span>
<span class="sd">    +-------+--------+------------------+</span>
<span class="sd">    |     8 |    3/4 | Half triplet     |</span>
<span class="sd">    +-------+--------+------------------+</span>
<span class="sd">    |     9 |    1/2 | Half note        |</span>
<span class="sd">    +-------+--------+------------------+</span>
<span class="sd">    |    10 |    1/3 | Dotted half note |</span>
<span class="sd">    +-------+--------+------------------+</span>
<span class="sd">    |    11 |    3/8 | Whole triplet    |</span>
<span class="sd">    +-------+--------+------------------+</span>
<span class="sd">    |    12 |    1/4 | Whole note       |</span>
<span class="sd">    +-------+--------+------------------+</span>

<span class="sd">    .. [1] Peeters, Geoffroy.</span>
<span class="sd">        &quot;Rhythm Classification Using Spectral Rhythm Patterns.&quot;</span>
<span class="sd">        In ISMIR, pp. 644-647. 2005.</span>

<span class="sd">    .. [2] Prockup, Matthew, Andreas F. Ehmann, Fabien Gouyon, Erik M. Schmidt, and Youngmoo E. Kim.</span>
<span class="sd">        &quot;Modeling musical rhythm at scale with the music genome project.&quot;</span>
<span class="sd">        In 2015 IEEE workshop on applications of signal processing to audio and acoustics (WASPAA), pp. 1-5. IEEE, 2015.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    y : np.ndarray [shape=(..., n)] or None</span>
<span class="sd">        audio time series</span>
<span class="sd">    sr : number &gt; 0 [scalar]</span>
<span class="sd">        sampling rate of the time series</span>
<span class="sd">    onset_envelope : np.ndarray [shape=(..., n)]</span>
<span class="sd">        pre-computed onset strength envelope</span>
<span class="sd">    tg : np.ndarray</span>
<span class="sd">        pre-computed tempogram.  If provided, then `y` and</span>
<span class="sd">        `onset_envelope` are ignored, and `win_length` is</span>
<span class="sd">        inferred from the shape of the tempogram.</span>
<span class="sd">    bpm : np.ndarray</span>
<span class="sd">        pre-computed tempo estimate.  This must be a per-frame</span>
<span class="sd">        estimate, and have dimension compatible with `tg`.</span>
<span class="sd">    hop_length : int &gt; 0 [scalar]</span>
<span class="sd">        hop length of the time series</span>
<span class="sd">    win_length : int &gt; 0 [scalar]</span>
<span class="sd">        window length of the autocorrelation window for tempogram</span>
<span class="sd">        calculation</span>
<span class="sd">    start_bpm : float [scalar]</span>
<span class="sd">        initial guess of the BPM if `bpm` is not provided</span>
<span class="sd">    std_bpm : float &gt; 0 [scalar]</span>
<span class="sd">        standard deviation of tempo distribution</span>
<span class="sd">    max_tempo : float &gt; 0 [scalar, optional]</span>
<span class="sd">        If provided, only estimate tempo below this threshold</span>
<span class="sd">    freqs : np.ndarray</span>
<span class="sd">        Frequencies (in BPM) of the tempogram axis.</span>
<span class="sd">    factors : np.ndarray</span>
<span class="sd">        Multiples of the fundamental tempo (bpm) to estimate.</span>
<span class="sd">        If not provided, the factors are as specified above.</span>
<span class="sd">    prior : scipy.stats.rv_continuous [optional]</span>
<span class="sd">        A prior distribution over tempo (in beats per minute).</span>
<span class="sd">        By default, a pseudo-log-normal prior is used.</span>
<span class="sd">        If given, ``start_bpm`` and ``std_bpm`` will be ignored.</span>
<span class="sd">    center : bool</span>
<span class="sd">        If `True`, onset windows are centered.</span>
<span class="sd">        If `False`, windows are left-aligned.</span>
<span class="sd">    aggregate : callable [optional]</span>
<span class="sd">        Aggregation function for estimating global tempogram ratio.</span>
<span class="sd">        If `None`, then ratios are estimated independently for each frame.</span>
<span class="sd">    window : string, function, number, tuple, or np.ndarray [shape=(win_length,)]</span>
<span class="sd">        A window specification as in `stft`.</span>
<span class="sd">    kind : str</span>
<span class="sd">        Interpolation mode for measuring tempogram ratios</span>
<span class="sd">    fill_value : float</span>
<span class="sd">        The value to fill when extrapolating beyond the observed</span>
<span class="sd">        frequency range.</span>
<span class="sd">    norm : {np.inf, -np.inf, 0, float &gt; 0, None}</span>
<span class="sd">        Normalization mode.  Set to `None` to disable normalization.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tgr : np.ndarray</span>
<span class="sd">        The tempogram ratio for the specified factors.</span>
<span class="sd">        If `aggregate` is provided, the trailing time axis</span>
<span class="sd">        will be removed.</span>
<span class="sd">        If `aggregate` is not provided (default), ratios</span>
<span class="sd">        will be estimated for each frame.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    tempogram</span>
<span class="sd">    tempo</span>
<span class="sd">    librosa.f0_harmonics</span>
<span class="sd">    librosa.tempo_frequencies</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Compute tempogram ratio features using the default factors</span>
<span class="sd">    for a waltz (3/4 time)</span>

<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; y, sr = librosa.load(librosa.ex(&#39;sweetwaltz&#39;))</span>
<span class="sd">    &gt;&gt;&gt; tempogram = librosa.feature.tempogram(y=y, sr=sr)</span>
<span class="sd">    &gt;&gt;&gt; tgr = librosa.feature.tempogram_ratio(tg=tempogram, sr=sr)</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots(nrows=2, sharex=True)</span>
<span class="sd">    &gt;&gt;&gt; librosa.display.specshow(tempogram, x_axis=&#39;time&#39;, y_axis=&#39;tempo&#39;,</span>
<span class="sd">    ...                          ax=ax[0])</span>
<span class="sd">    &gt;&gt;&gt; librosa.display.specshow(tgr, x_axis=&#39;time&#39;, ax=ax[1])</span>
<span class="sd">    &gt;&gt;&gt; ax[0].label_outer()</span>
<span class="sd">    &gt;&gt;&gt; ax[0].set(title=&quot;Tempogram&quot;)</span>
<span class="sd">    &gt;&gt;&gt; ax[1].set(title=&quot;Tempogram ratio&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get a tempogram and time-varying tempo estimate</span>
    <span class="k">if</span> <span class="n">tg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tg</span> <span class="o">=</span> <span class="n">tempogram</span><span class="p">(</span>
            <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
            <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">,</span>
            <span class="n">onset_envelope</span><span class="o">=</span><span class="n">onset_envelope</span><span class="p">,</span>
            <span class="n">hop_length</span><span class="o">=</span><span class="n">hop_length</span><span class="p">,</span>
            <span class="n">win_length</span><span class="o">=</span><span class="n">win_length</span><span class="p">,</span>
            <span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">,</span>
            <span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span>
            <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">freqs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">freqs</span> <span class="o">=</span> <span class="n">tempo_frequencies</span><span class="p">(</span><span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">,</span> <span class="n">n_bins</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">tg</span><span class="p">),</span> <span class="n">hop_length</span><span class="o">=</span><span class="n">hop_length</span><span class="p">)</span>

    <span class="c1"># Estimate tempo per-frame, no aggregation yet</span>
    <span class="k">if</span> <span class="n">bpm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">bpm</span> <span class="o">=</span> <span class="n">tempo</span><span class="p">(</span>
            <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">,</span>
            <span class="n">tg</span><span class="o">=</span><span class="n">tg</span><span class="p">,</span>
            <span class="n">hop_length</span><span class="o">=</span><span class="n">hop_length</span><span class="p">,</span>
            <span class="n">start_bpm</span><span class="o">=</span><span class="n">start_bpm</span><span class="p">,</span>
            <span class="n">std_bpm</span><span class="o">=</span><span class="n">std_bpm</span><span class="p">,</span>
            <span class="n">max_tempo</span><span class="o">=</span><span class="n">max_tempo</span><span class="p">,</span>
            <span class="n">aggregate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">prior</span><span class="o">=</span><span class="n">prior</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">factors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># metric multiples from Prockup&#39;15</span>
        <span class="n">factors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">4</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="n">tgr</span> <span class="o">=</span> <span class="n">f0_harmonics</span><span class="p">(</span>
        <span class="n">tg</span><span class="p">,</span> <span class="n">freqs</span><span class="o">=</span><span class="n">freqs</span><span class="p">,</span> <span class="n">f0</span><span class="o">=</span><span class="n">bpm</span><span class="p">,</span> <span class="n">harmonics</span><span class="o">=</span><span class="n">factors</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">fill_value</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">aggregate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">aggregate</span><span class="p">(</span><span class="n">tgr</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

    <span class="k">return</span> <span class="n">tgr</span></div>
</pre></div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013--2023, librosa development team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  

<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: main
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Releases</dt>
      <dd><a href="../../../../0.10.0/index.html">0.10.0</a></dd>
      <dd><a href="../../../../0.8.1/index.html">0.8.1</a></dd>
      <dd><a href="../../../../0.9.2/index.html">0.9.2</a></dd>
    </dl>
    <dl>
      <dt>Development versions</dt>
      <dd><a href="rhythm.html">main</a></dd>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-171031946-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-171031946-1', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>